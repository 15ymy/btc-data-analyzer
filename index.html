<!DOCTYPE html>
<html>
<head>
  <title>数据提取和计算</title>
</head>
<body>
  <h1>请将数据粘贴到下面的文本框中:</h1>
  <textarea id="data-input" rows="10" cols="50"></textarea>
  <br>
  <button onclick="calculateSum()">计算结果</button>
  <br>
  <h2>结果:</h2>
  <p id="result"></p>

  <script>
    function calculateSum() {
      const data = document.getElementById('data-input').value;
      const sections = data.split('\n\n');
      const values = {};

      for (let section of sections) {
        const lines = section.split('\n');
        
        // 第一步,提取数据
        for (let i = 2; i < lines.length; i++) {
          const parts = lines[i].split(':');
          if (parts.length === 2) {
            const period = parts[0].trim();
            const valueStr = parts[1].trim();
            const match = valueStr.match(/(-?\d+(\.\d+)?)(m|b|k)/i);

            if (match) {
              let value = parseFloat(match[1]);
              const unit = match[3].toLowerCase();

              // 第二步,转换为同单位的数据
              if (unit === 'b') {
                value *= 1000;
              } else if (unit === 'k') {
                value /= 1000;
              }

              if (!values[period]) {
                values[period] = [];
              }
              values[period].push(value);
            }
          }
        }
      }

      let sum = 0;
      for (let period in values) {
        // 第三步,相同时间段的两个数据相加
        const periodSum = values[period].reduce((a, b) => a + b, 0);
        sum += periodSum;
      }

      // 第四步,把第三步得出的所有数据相加
      document.getElementById('result').innerText = `总和为: ${sum.toFixed(2)} 百万美元`;
    }
  </script>
</body>
</html>
