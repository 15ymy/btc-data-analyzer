<!DOCTYPE html>
<html>
<head>
    <title>BTC Data Analyzer</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        textarea {
            width: 100%;
            margin-bottom: 10px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            max-width: 800px;
            margin: auto;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .positive {
            color: green;
        }
        .negative {
            color: red;
        }
    </style>
</head>
<body>
    <h1>BTC Data Analyzer</h1>
    <textarea id="original-data" rows="10" cols="100" placeholder="在此处粘贴原始数据"></textarea>
    <br>
    <textarea id="latest-data" rows="10" cols="100" placeholder="在此处粘贴最新数据"></textarea>
    <br>
    <button onclick="analyzeData()">Analyze Data</button>
    <br><br>
    <table id="dataTable">
        <thead>
            <tr>
                <th>时段</th>
                <th>机构资金差</th>
                <th>散户资金差</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        function analyzeData() {
            const originalDataInput = document.getElementById('original-data').value;
            const latestDataInput = document.getElementById('latest-data').value;

            const originalData = processData(originalDataInput);
            const latestData = processData(latestDataInput);

            const labels = originalData.labels;
            const institutionalData = latestData.institutionalData.map((latest, i) => latest - originalData.institutionalData[i]);
            const retailData = latestData.retailData.map((latest, i) => latest - originalData.retailData[i]);

            const tbody = document.querySelector('#dataTable tbody');
            tbody.innerHTML = '';

            for (let i = 0; i < labels.length; i++) {
                const row = document.createElement('tr');

                const periodCell = document.createElement('td');
                periodCell.textContent = labels[i];
                row.appendChild(periodCell);

                const institutionalCell = document.createElement('td');
                institutionalCell.textContent = formatNumber(institutionalData[i]);
                institutionalCell.classList.add(institutionalData[i] >= 0 ? 'positive' : 'negative');
                row.appendChild(institutionalCell);

                const retailCell = document.createElement('td');
                retailCell.textContent = formatNumber(retailData[i]);
                retailCell.classList.add(retailData[i] >= 0 ? 'positive' : 'negative');
                row.appendChild(retailCell);

                tbody.appendChild(row);
            }
        }

        function processData(dataInput) {
            const dataLines = dataInput.split('\n');
            const labels = [];
            const institutionalData = [];
            const retailData = [];

            for (let i = 0; i < dataLines.length; i++) {
                const line = dataLines[i].trim();
                if (line.startsWith('period')) {
                    const dataPoints = dataLines.slice(i + 1);
                    for (const point of dataPoints) {
                        const [period, institutional, retail] = point.split(/\s+/);
                        labels.push(period);
                        institutionalData.push(parseFloat(institutional));
                        retailData.push(parseFloat(retail));
                    }
                    break;
                }
            }

            return { labels, institutionalData, retailData };
        }

        function formatNumber(number) {
            const absNumber = Math.abs(number);
            const sign = number >= 0 ? '+' : '-';
            if (absNumber >= 1e9) {
                return sign + (absNumber / 1e9).toFixed(2) + 'b';
            } else if (absNumber >= 1e6) {
                return sign + (absNumber / 1e6).toFixed(2) + 'm';
            } else if (absNumber >= 1e3) {
                return sign + (absNumber / 1e3).toFixed(2) + 'k';
            } else {
                return sign + absNumber.toFixed(2);
            }
        }
    </script>
</body>
</html>
