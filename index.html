<!DOCTYPE html>
<html>
<head>
    <title>BTC Data Analyzer</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        textarea {
            width: 100%;
            margin-bottom: 10px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            max-width: 800px;
            margin: auto;
            font-family: monospace;
            white-space: pre;
        }
        th, td {
            padding: 4px;
            text-align: left;
        }
        .positive {
            color: green;
        }
        .negative {
            color: red;
        }
    </style>
</head>
<body>
    <h1>BTC Data Analyzer</h1>
    <textarea id="original-data" rows="10" cols="100" placeholder="在此处粘贴原始数据"></textarea>
    <br>
    <textarea id="latest-data" rows="10" cols="100" placeholder="在此处粘贴最新数据"></textarea>
    <br>
    <button onclick="analyzeData()">Analyze Data</button>
    <br><br>
    <table id="dataTable">
        <tbody></tbody>
    </table>

    <script>
        function analyzeData() {
            const originalDataInput = document.getElementById('original-data').value;
            const latestDataInput = document.getElementById('latest-data').value;

            const originalData = processData(originalDataInput);
            const latestData = processData(latestDataInput);

            const labels = originalData.labels;
            const institutionalData = latestData.institutionalData.map((latest, i) => latest - originalData.institutionalData[i]);
            const retailData = latestData.retailData.map((latest, i) => latest - originalData.retailData[i]);

            const tbody = document.querySelector('#dataTable tbody');
            tbody.innerHTML = '';

            const priceDiff = latestData.price - originalData.price;
            const priceRow = document.createElement('tr');
            priceRow.innerHTML = `<td colspan="3">BTC价格: ${latestData.price}U (${formatNumber(priceDiff)}U)</td>`;
            tbody.appendChild(priceRow);

            const headerRow = document.createElement('tr');
            headerRow.innerHTML = '<td>时段   机构资金差   散户资金差</td>';
            tbody.appendChild(headerRow);

            for (let i = 0; i < labels.length; i++) {
                const row = document.createElement('tr');
                const institutional = formatNumber(institutionalData[i]);
                const retail = formatNumber(retailData[i]);
                row.innerHTML = `<td>${labels[i]}: ${institutional.padStart(10)} ${retail.padStart(10)}</td>`;
                tbody.appendChild(row);
            }
        }

        function processData(dataInput) {
            const dataLines = dataInput.split('\n');
            const labels = [];
            const institutionalData = [];
            const retailData = [];
            let price = null;

            for (let i = 0; i < dataLines.length; i++) {
                const line = dataLines[i].trim();
                if (line.includes('最近交易价格')) {
                    price = parseFloat(line.match(/\((\d+(\.\d+)?)/)[1]);
                } else if (line.startsWith('period')) {
                    const dataPoints = dataLines.slice(i + 1);
                    for (const point of dataPoints) {
                        const [period, institutional, retail] = point.split(/\s+/);
                        labels.push(period);
                        institutionalData.push(parseFloat(institutional));
                        retailData.push(parseFloat(retail));
                    }
                    break;
                }
            }

            return { labels, institutionalData, retailData, price };
        }

        function formatNumber(number) {
            const absNumber = Math.abs(number);
            const sign = number >= 0 ? '+' : '-';
            if (absNumber >= 1e9) {
                return sign + (absNumber / 1e9).toFixed(2) + 'b';
            } else if (absNumber >= 1e6) {
                return sign + (absNumber / 1e6).toFixed(2) + 'm';
            } else if (absNumber >= 1e3) {
                return sign + (absNumber / 1e3).toFixed(2) + 'k';
            } else {
                return sign + absNumber.toFixed(2);
            }
        }
    </script>
</body>
</html>
